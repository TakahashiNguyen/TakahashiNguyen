<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />

		<style>
			body {
				margin: 0;
				overflow: hidden;
				width: 100dvw;
				height: 100dvh;
			}
			canvas {
				display: block;
			}
		</style>

		<script type="text/javascript" src="../.js/utils.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
	</head>
	<body id="body">
		<script>
			(async () => {
				class App extends GLSLElement {
					constructor(element) {
						super(element);
					}

					async start() {
						//await fetchFromURL("../.frag/mario.frag").then((data) => (this.bufferMario = this.initBuffer(false, data)));
						this.bufferA = await this.initBuffer(false, "../.frag/liquify/a.frag");
						this.bufferB = await this.initBuffer(false, "../.frag/liquify/b.frag");
						this.bufferImage = await this.initBuffer(true, "../.frag/liquify/image.frag", this.mainChannel);

						this.animate();
					}

					animate() {
						requestAnimationFrame(async () => {
							// bufferA section
							this.bufferA.setChannel(0, this.bufferA);
							this.bufferA.setChannel(1, this.bufferB);

							// bufferB section
							this.bufferB.setChannel(0, this.bufferB);

							// bufferImage section
							//this.bufferImage.uniforms.iChannel0.value = this.bufferMario.readBuffer.texture;
							this.bufferImage.setChannel(1, this.bufferA);

							// Render section
							this.bufferA.render();
							this.bufferB.render();
							this.bufferImage.render();

							this.setDOMSize();
							this.animate();
						});
					}
				}

				document.addEventListener("DOMContentLoaded", async () => {
					new App("videoChannel");
					new App("imageChannel");
				});
			})();
		</script>

		<div style="position: relative; display: flex; flex-direction: column">
			<video
				id="videoChannel"
				autoplay
				loop
				muted
				src="../.webm/greenScreenMan.webm"
				style="width: 100%; display: block"
			></video>
			<img src="../.jpg/ISS.jpg" alt="" width="100%" height="500" id="imageChannel" />
		</div>
	</body>
</html>
